<div class="page-container">
  <app-buscador (onSearch)="facade.updateFilter($event)" />

  <div class="brands-filter">
  
    <button
      class="brand-chip"
      [class.active]="facade.isAllMode()"
      (click)="facade.resetFilters()">
      Todos
    </button>

    <button
      class="brand-chip news-chip"
      [class.active]="facade.showOnlyNews()"
      (click)="facade.activateNews()">
      Novedades
    </button>

    <button
      class="brand-chip combo-chip"
      [class.active]="facade.showOnlyCombos()"
      (click)="facade.activateCombos()">
      Combos
    </button>

    @for (marca of facade.marcasDisponibles(); track marca) {
      <button 
        class="brand-chip"
        [class.active]="facade.selectedBrand() === marca"
        (click)="facade.selectBrand(marca)">
        {{ marca }}
      </button>
    }

  </div>

  <div class="grid">
    
    @for (item of facade.filteredItems(); track item.codigo) {
      <app-card-producto [item]="item"></app-card-producto>
    }
  </div>

  @if (facade.selectedGalleryItem(); as item) {
    <div class="lightbox-overlay" (click)="facade.closeLightbox()">
      <button class="close-btn" (click)="facade.closeLightbox()">✕</button>
      
      <div class="lightbox-content" (click)="$event.stopPropagation()">
        @if (item.images && item.images.length > 1) {
          <button class="nav-btn-large prev" (click)="facade.prevImage()">❮</button>
        }

        <img [src]="item.images![facade.currentImageIndex()].url" class="img-large">

        @if (item.images && item.images.length > 1) {
          <button class="nav-btn-large next" (click)="facade.nextImage()">❯</button>
        }
        
        <div class="lightbox-info">
          <p>{{ item.descripcion }}</p>
          <span>{{ facade.currentImageIndex() + 1 }} / {{ item.images?.length }}</span>
        </div>
      </div>
    </div>
  }
</div>

